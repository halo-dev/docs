---
title: 支付方式
description: 商城支付方式相关使用文档。
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

在正式运营商城之前，我们需要配置至少一个可用的支付方式，目前商城支持的支付方式包括：

- 支付宝
- 微信支付
- 银行转账（手动）
- 收款码支付（手动）

首先我们需要登录到 Halo 控制台，并进入 **商店 -> 设置 -> 支付方式** 页面，并点击右上角的新建按钮。

<Tabs>
  <TabItem value="1️⃣ 进入支付方式页面">
    ![](/img/user-guide/shop/settings-payments.png)
  </TabItem>
  <TabItem value="2️⃣ 新建支付方式">
    ![](/img/user-guide/shop/settings-payments-create.png)
  </TabItem>
</Tabs>

:::note
在配置支付方式之前，建议先创建一个测试产品，方便在配置完成后进行测试。
:::

## 支付宝

### 创建支付宝应用

支付宝支付方式使用的是支付宝官方提供的接口，买家交易的资金会直接进入商家的支付宝账户，没有三方平台介入。

在创建支付宝支付方式之前，我们需要先在支付宝商家平台和支付宝开放平台注册并申请。

- [支付宝商家平台](https://b.alipay.com/)
- [支付宝开放平台](https://open.alipay.com/)

注册完成后，进入支付宝 [开放平台 -> 控制台](https://open.alipay.com/develop/manage)，点击 **创建网页/移动应用** 按钮创建一个新的应用：

![](/img/user-guide/shop/settings-payments-alipay-create-app.png)

其中 **应用类型** 选择网页应用，其他参数按照实际情况填写即可。

### 获取支付宝配置信息

创建完应用之后，进入应用详情页面，如下所示：

![](/img/user-guide/shop/settings-payments-alipay-app-detail.png)

- 1️⃣：应用 ID
- 2️⃣：设置接口加签方式
    - 加签方式选择 **密钥** 即可
    - 其他流程按照支付宝的指引进行操作即可
    - 最后需要下载 **支付宝公钥证书** 到本地，后续在 Halo 中配置会用到
- 3️⃣：接口内容加密方式，点击 **生成加密方式** 并复制生成的密文即可

### 在 Halo 中配置

打开新建支付方式的界面，支付提供商选择 **支付宝支付**，并填写以下信息：

- 是否启用：勾选
- 名称：给用户展示的支付方式名称
- 场景：选择 **PC 网页支付**
- 网关地址：`https://openapi.alipay.com`
- 支付宝账号 ID：进入支付宝开放平台的账户中心，复制 **账号 ID** 即可
- 应用 ID：上一步中获取的应用 ID
- 商户私钥：上一步在工具中生成的密钥文件
- 支付宝公钥：上一步中下载的 `alipayCertPublicKey_RSA2.crt` 文件内容
- 加密密钥：上一步中生成的加密密钥

配置完成之后保存即可。

### 沙箱环境

访问 [沙箱应用 - 开放平台](https://open.alipay.com/develop/sandbox/app)，按照页面上的信息在 Halo 中配置即可。

## 微信支付

### 申请微信支付商户号

微信支付使用的是微信官方提供的支付接口，买家交易的资金会直接进入商家的微信支付商户账户，没有三方平台介入。

在配置微信支付之前，我们需要先在微信支付商户平台申请商户号。

- [微信支付商户平台](https://pay.weixin.qq.com/)
- [微信支付开发文档](https://pay.weixin.qq.com/doc/v3/merchant/4012791874)

注册并完成商户认证后，进入 [微信支付商户平台](https://pay.weixin.qq.com/)，开通 **Native 支付**。

### 获取微信支付配置信息

登录微信支付商户平台后，需要获取以下配置信息：

#### 获取商户号

进入商户平台的 **账户中心 -> 商户信息**，可以查看到您的微信支付商户号（Mch ID）。

#### 设置 API 密钥

1. 进入 **账户中心 -> API 安全 -> API v3 密钥**
2. 点击 **设置密钥** 按钮，按照提示设置 API v3 密钥（32 位字符串）
3. 请妥善保管该密钥，后续在 Halo 中配置时需要使用

#### 申请 API 证书

1. 进入 **账户中心 -> API 安全 -> 验证商户身份 -> 商户API证书**
2. 点击 **申请 API 证书** 或 **管理证书**
3. 按照页面指引完成操作后，下载证书文件（包含 `apiclient_cert.pem` 和 `apiclient_key.pem`）
4. 在证书管理页面可以查看到证书序列号，记录下来以便配置

#### 获取微信 AppID

1. 进入 **产品中心 -> AppID 账号管理**
2. 关联您的微信公众号、小程序或企业微信
3. 记录下对应的 AppID

### 在 Halo 中配置

打开新建支付方式的界面，支付提供商选择 **微信支付**，并填写以下信息：

- 是否启用：勾选
- 名称：给用户展示的支付方式名称
- 场景：选择 **PC 网页支付**
- 应用 ID：上一步获取的微信 AppID
- 商户号：上一步获取的商户号（Mch ID）
- 商户私钥：上一步下载的 `apiclient_key.pem` 文件内容
- 商户证书序列号：上一步获取的证书序列号
- API V3 密钥：上一步设置的 API v3 密钥

配置完成之后保存即可。

### 配置支付授权目录

在微信支付商户平台中，还需要配置支付授权目录：

1. 登录微信支付商户平台
2. 进入 **产品中心 -> 开发配置**
3. 在 **支付授权目录** 中添加您的网站支付页面地址，例如：`https://example.com/`
